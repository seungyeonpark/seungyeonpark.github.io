---
title: "Elasticsearch 구성 요소"
excerpt: "Elasticsearch를 구성 요소들에 대해 알아보자"

categories:
  - Security
tags:
  - [HSM]

permalink: /elasticsearch/elasticsearch-architecture

toc: true
toc_sticky: true

date: 2024-02-27
last_modified_at: 2024-02-27
---

## 0. Overview
- 클러스터 > 인덱스 > 도큐먼트
  - 관계형 데이터베이스와 엘라스틱서치 비교
  
    |RDB|Elsaticsearch|
    |---|---|
    |Table|Index|
    |Record|Document|
    |Column|Field|
    |Schema|Mapping|


<br>
<br>

## 1. Index
- 도큐먼트를 저장하는 논리적 단위
- 인덱스와 도큐먼트는 일대다 관계
- 모든 도큐먼트는 반드시 하나의 인덱스에 포함돼야 한다
- 그룹핑
  - 스키마에 따른 그룹핑
    - 스키마에 따라 인덱스를 구분하는 것이 기본
    - 인덱스 스키마는 매핑을 통해 정의
  - 관리 목적의 그룹핑
    - 인덱스가 커지면 검색 시 많은 도큐먼트를 참조해야 하기 때문에 성능 저하
    - 기본적으로 특정 도큐먼트 개수에 도달하거나 특정 용량을 넘어서면 인덱스를 분리하도록 제한
    - 일/주/월/년 단위 같은 날짜/시간 단위로 인덱스를 분리하기도 한다

<br>
<br>

## 2. Document
- 엘라스틱서치에 데이터가 저장되는 기본 단위
- 하나의 도큐먼트는 여러 필드와 값을 가진다
- JSON 형식의 도큐먼트 파일
    
    ``` json
    {
        "name": "sypark",
        "age": 20,
        "gender": "female"
    }
    ```
2-1. 도큐먼트 생성
- 엘라스틱서치에서 도큐먼트를 인덱스에 포함시키는 것을 인덱싱이라고 한다
- dynamic mapping
  - 데이터 타입을 지정하지 않아도 도큐먼트의 필드와 값을 통해 동적 타입 지원
- 묵시적 형변환 지원
  - 정수 필드: "10" 입력 -> 10 변환 (<< integer 필드에 value를 "10"으로 지정해서 인서트하니까 400에러났는데?)
  - 정수 필드: 10.0 입력 -> 10 변환

2-2. 도큐먼트 수정
- 엘라스틱서치 도큐먼트 수정 작업은 비용이 많이 들기 때문에 권장하지 않는다
- 개별 도큐먼트 수정이 많은 작업이라면 다른 데이터베이스를 사용하는 것을 권장

2-3. 도큐먼트 삭제
- 특정 도큐먼트를 삭제하기 위해서는 인덱스명과 도큐먼트 아이디가 필요
- 도큐먼트 삭제 또한 비용이 많이 들어가는 작업이므로 사용에 주의

<br>
<br>

## 3. Response Message
- 엘라스틱서치의 응답 결과로 전달하는 상태 코드 값들은 일반적인 HTTP 프로토콜의 응답 상태 값과 의미가 동일하다

    |code|status|
    |---|---|
    |200, 201|정상 수행|
    |4xx|클라이언트 오류|
    |404|인덱스나 도큐먼트가 존재하는지 체크|
    |405|요청 메소드(POST, PUT) 등 API 사용법 다시 확인|
    |429|요청 과부하로 재전송, 노드 추가와 같은 조치 필요|
    |5xx|서버 오류|

<br>
<br>

## 4. Bulk Data
- bulk API를 통해 REST API 콜 횟수를 줄여 성능을 향상할 수 있음

## 5. Mapping
## 7. Index Template
## 8. Analyzer