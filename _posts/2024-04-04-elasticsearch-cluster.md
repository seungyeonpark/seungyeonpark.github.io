---
title: "Elasticsearch 클러스터"
excerpt: "Elasticsearch 클러스터에 대해 알아보자"

categories:
  - ELK
tags:
  - [elasticsearch]

permalink: /elk/elasticsearch-cluster

toc: true
toc_sticky: true

date: 2024-04-04
last_modified_at: 2024-04-04
---

## 1. 클러스터 구성
### 1-1. 소규모 클러스터 구성 예시
![programing-environment-architecture](../assets/images/posts-img/elasticsearch-cluster-1.jpg)
- 마스터 후보 노드는 홀수로 지정해야 한다
- 데이터 노드는 많은 컴퓨터 리소스를 필요로 하기 때문에 가능한 많을수록 좋다

<br>

### 1-2. 대규모 클러스터  구성 예시
![programing-environment-architecture](../assets/images/posts-img/elasticsearch-cluster-2.jpg)
- 마스터 후보 노드들은 하드웨어 성능은 비교적 중요하지 않지만 최소 3대를 준비하고 가능한 한 클라이언트의 요청을 받지 않도록 구성한다
- 데이터 전용 노드는 온전히 데이터 작업만 진행하고 클러스터에서 가장 많이 배치해야 한다
- 데이터 전용 노드는 가능하면 고사양의 하드웨어를 구성하고 사양은 통일하는 것이 좋다
  - 분산 처리 시 복수의 노드에서 발생한 결과를 코디네이터 노드에서 취합해야 하는데 데이터 노드 하나의 응답이 느리면 전체 응답 속도에 영향을 미치기 떄문이다
- 데이터 읽기가 많은 시스템인지 데이터 쓰기가 많은 시스템인지 데이터가 얼마나 많이 필요한지에 따라 노드들을 다양하게 구성할 수 있다
- 다만 대규모 클러스터를 구성할 때 마스터 후보 전용 노드와 데이터 전용 노드를 나고, 마스터 노드는 클라이언트의 요청이나 데이터 작업에 참여하지 않고 클러스터 관리에 집중시키는 것이 좋다

<br>

### 1-3. 핫/웜/콜드 노드 구성
- 핫 노드
  - 활발하게 인덱싱과 검색이 일어나는 인덱스를 위치 시키고 충분한 리소스의 하드웨어 할당
- 웜 노드
  - 자주 사용하지 않는 데이터를 저장
  - 쿼리의 빈도가 낮고 인덱싱은 일어나지 않는 인덱스
  - 핫노드에 비해 성능 좋은 디스크나 큰 메모리는 필요 없지만 많은 데이터를 저장하기 위해 대용량 디스크를 사용
- 콜드 노드
  - 프리즈 모드의 인덱스를 저장
  - 프리즈 모드의 인덱스는 평상시에는 메모리에 띄워놓지 않으므로 인덱스를 유지하기 위한 메모리 공간이 필요하지는 않음
  - 검색 요청이 올 때 인덱스 파일을 오픈하기 때문에 검색 시간이 많이 소요
  - 하드웨어는 시스템 내에서 지원하는 최소한의 사양으로 구성하되 디스크의 용량만 필요한 만큼 갖추면 되고, 가용성을 위한 시스템 구성은 필요 없다

<br>
<br>

## 2. 클러스터 백업
- repository를 지정하고 snapshot을 찍고 복원할 수 있다
- snapshot은 클러스터 전체를 찍거나 특정 인덱스만 찍을 수 있다

### 2-1. repository 등록
- repository 등록 API
  ``` 
  PUT _snapshot/fsrepo
  {
    "type" : "fs",
    "settings" : {
      "location" : "C:\\elasticsearch-7.10.1"
    }
  }
  ```
  - 지원하는 타입
    - fs, hdfs, s3, azure, gcs
  - repository는 클러스터를 구성하는 마스터 노드와 데이터 노드가 동일한 위치를 공유해야 한다

### 2-2. snapshot 찍기
### 2-3. snapshot 복원

<br>
<br>

## 3. 샤드
### 3-1. 프라이머리 샤드와 레플리카 샤드
### 3-2. 샤드 할당 과정
### 3-3. 샤드 상태 모니터링

<br>
<br>

## 4. 샤드 개수와 구성
### 4-1. 샤드 개수
### 4-2. 샤드 크기

<br>
<br>

## 5. 설정
### 5-1. 클러스터 설정
### 5-2. 노드 설정
### 5-3. 인덱스 설정
